<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Busca de Médicos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #eef2f7;
      padding: 20px;
    }

    .login-container, .main-content {
      max-width: 900px;
      margin: auto;
    }

    .login-container {
      margin-top: 100px;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .main-content {
      margin-top: 30px;
    }

    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      background: #007bff;
      border: none;
      color: white;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #0056b3;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .filters button {
      background-color: #6c757d;
      padding: 8px 15px;
    }

    .filters button.active {
      background-color: #28a745;
    }

    .results .card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      margin-bottom: 15px;
    }

    .detalhes {
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px solid #dee2e6;
      font-size: 14px;
    }

    .result-count {
      font-size: 14px;
      margin-bottom: 10px;
      color: #555;
    }
  </style>
</head>
<body>

<div class="login-container" id="loginContainer">
  <h2 class="text-center">Acesso Restrito</h2>
  <input type="text" id="login" placeholder="Login">
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="validarLogin()">Confirmar</button>
</div>

<div class="main-content" id="mainContent" style="display: none;">
  <h2 class="mb-4">Busca de Médicos</h2>
  <div class="d-flex flex-wrap gap-2 mb-3">
    <input type="text" id="searchInput" placeholder="Digite nome ou CRM" class="form-control flex-grow-1">
    <button onclick="buscar()" class="btn btn-primary">Buscar</button>
  </div>
  <div class="filters" id="filterButtons"></div>
  <div class="result-count" id="resultCount"></div>
  <div class="results" id="results"></div>
</div>

<script>
  const loginCorreto = "M&G2025";
  const senhaCorreta = "M&G@!2025QG";

  document.getElementById("senha").addEventListener("keypress", function(e) {
    if (e.key === "Enter") validarLogin();
  });

  function validarLogin() {
    const login = document.getElementById("login").value;
    const senha = document.getElementById("senha").value;

    if (login === loginCorreto && senha === senhaCorreta) {
      document.getElementById("loginContainer").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
      criarBotoesFiltro();
      buscarDados();
    } else {
      alert("Login ou senha incorretos.");
    }
  }

  const apiURL = 'https://sheetdb.io/api/v1/cahitouo88zxm';
  let dados = [];
  let filtroAtual = 'Todos';

  const sinonimosHospitais = {
    "CEJAM": ["cejam", "cejam ", " cejam", "Cejam", "cejan"],
    "AME CARAPICUIBA": ["ame carapicuiba", "carapicuiba", "ame carapícuiba", "carapícuiba", "Ame Carapicuiba", "Carapicuíba"],
    "MBOI": ["mboi", "mbói", "M'Boi", "Mboi Mirim"],
    "Tiradentes": ["tiradentes", "tiradêntes", "tiradentis"],
    "ITAIM": ["itaim", "itain", "itáim"],
    "HGG": ["hgg", "hospital geral grajaú"],
    "HMB": ["hmb", "hospital municipal barreto"],
    "HGP": ["hgp", "hospital geral pirajussara"],
    "Pedreira": ["H. Pedreira", "PEDREIRA", "pedreira", "pedrêra", "Hospital Pedreira", "Hosp Pedreira"],
    "Ame dos Prados": ["ame dos prados", "ame prados", "dos prados"],
    "HMU": ["hmu", "hospital municipal de urgência"],
    "CHS": ["chs", "centro hospitalar sul"]
  };

  function removerAcentos(str) {
    return str.normalize("NFD").replace(/[̀-ͯ]/g, "");
  }

  function normalizarHospital(hospital) {
    const chave = removerAcentos(hospital?.toLowerCase().trim() || '');
    for (const [padrao, sinonimos] of Object.entries(sinonimosHospitais)) {
      if (sinonimos.map(removerAcentos).includes(chave)) return padrao;
    }
    return hospital || '';
  }

  async function buscarDados() {
    const response = await fetch(apiURL);
    const json = await response.json();
    dados = json.map(p => ({ ...p, HospitalNormalizado: normalizarHospital(p["Hospital"]) }));
    renderizarResultados(dados);
  }

  function buscar() {
    const termo = document.getElementById("searchInput").value.toLowerCase();
    const filtrado = dados.filter(p =>
      p["Nome"]?.toLowerCase().includes(termo) ||
      p["CRM"]?.toLowerCase().includes(termo)
    );
    const filtradoPorHospital = filtroAtual === 'Todos' ? filtrado : filtrado.filter(p => p.HospitalNormalizado === filtroAtual);
    renderizarResultados(filtradoPorHospital);
  }

  function filtrar(hospital) {
    filtroAtual = hospital;
    document.querySelectorAll(".filters button").forEach(btn => btn.classList.remove("active"));
    [...document.querySelectorAll(".filters button")].find(b => b.textContent === hospital).classList.add("active");
    buscar();
  }

  function renderizarResultados(lista) {
    const container = document.getElementById("results");
    const resultCount = document.getElementById("resultCount");

    resultCount.textContent = `${lista.length} resultado(s) encontrado(s).`;

    if (lista.length === 0) {
      container.innerHTML = "<p class='text-muted'>Nenhum resultado encontrado.</p>";
      return;
    }

    container.innerHTML = lista.map((pessoa) => `
      <div class="card">
        <h5>${pessoa["Nome"] || 'N/A'} - CRM: ${pessoa["CRM"] || 'N/A'}</h5>
        <p><strong>Especialidade:</strong> ${pessoa["Especialidade"] || 'N/A'}<br>
        <strong>Hospital:</strong> ${pessoa["Hospital"] || 'N/A'}</p>
        <div class="detalhes">
          <strong>IR:</strong> ${pessoa["IR"] || 'N/A'}<br>
          <strong>Contrato:</strong> ${pessoa["Contrato"] || 'N/A'}<br>
          <strong>CPF:</strong> ${pessoa["CPF"] || 'N/A'}<br>
          <strong>RQE:</strong> ${pessoa["RQE"] || 'N/A'}<br>
          <strong>Nome da Mãe:</strong> ${pessoa["Nome da Mãe"] || 'N/A'}<br>
          <strong>Data de Nascimento:</strong> ${pessoa["Data de Nascimento"] || 'N/A'}<br>
          <strong>PIX:</strong> ${pessoa["PIX"] || 'N/A'}<br>
          <strong>Banco:</strong> ${pessoa["Banco"] || 'N/A'}<br>
          <strong>Código do Banco:</strong> ${pessoa["Codigo do Banco"] || 'N/A'}<br>
          <strong>Agência:</strong> ${pessoa["Agência sem digito"] || 'N/A'}<br>
          <strong>Conta:</strong> ${pessoa["Conta com o Dígito"] || 'N/A'}<br>
          <strong>Estado civil:</strong> ${pessoa["Estado Civil"] || 'N/A'}<br>
          <strong>Naturalidade:</strong> ${pessoa["Naturalidade"] || 'N/A'}<br>
          <strong>E-mail:</strong> ${pessoa["E-mail"] || 'N/A'}<br>
          <strong>WhatsApp:</strong> ${pessoa["Whatsapp"] || 'N/A'}<br>
          <strong>CEP:</strong> ${pessoa["CEP"] || 'N/A'}<br>
          <strong>Endereço:</strong> ${pessoa["Endereço"] || 'N/A'}
        </div>
      </div>
    `).join('');
  }

  function criarBotoesFiltro() {
    const container = document.getElementById("filterButtons");
    const blocos = ["Todos", ...Object.keys(sinonimosHospitais)];
    container.innerHTML = blocos.map(bloco => `
      <button onclick="filtrar('${bloco}')" class="btn ${bloco === 'Todos' ? 'btn-success active' : 'btn-secondary'}">${bloco}</button>
    `).join('');
  }

  document.getElementById("searchInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") buscar();
  });
</script>

</body>
</html>
